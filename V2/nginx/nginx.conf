server {
    listen 80;

    # MCP-Server (Streamable HTTP)
    location /mcp {
        proxy_pass http://mcp:8000/mcp;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header Connection '';
        proxy_buffering off;
        proxy_cache off;
        chunked_transfer_encoding off;
    }

    # Mermaid Render Proxy – URL generieren
    location /render-url {
        proxy_pass http://mermaid:8001/render-url;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header Content-Type $http_content_type;
    }

    # Mermaid Render Proxy – PNG direkt
    location /render {
        proxy_pass http://mermaid:8001/render;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header Content-Type $http_content_type;
    }

    # Health Check
    location /health {
        proxy_pass http://mermaid:8001/health;
    }
}
